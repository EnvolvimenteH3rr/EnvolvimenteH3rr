name:ğŸ”CodeQLAdvancedSecurity

on:
push:
branches:[main,develop]
pull_request:
branches:[main,develop]
schedule:
-cron:'00**1'#Segunda-feiraÃ meia-noite

permissions:
actions:read
contents:read
security-events:write

jobs:
codeql-analysis:
name:ğŸ•µï¸CodeQLAnalysis
runs-on:ubuntu-latest
strategy:
fail-fast:false
matrix:
language:['javascript','typescript']

steps:
-name:ğŸ“¥Checkout
uses:actions/checkout@v4

-name:ğŸ”§InitializeCodeQL
uses:github/codeql-action/init@v3
with:
languages:${{matrix.language}}
queries:security-extended,security-and-quality

-name:ğŸ—ï¸Autobuild
uses:github/codeql-action/autobuild@v3

-name:ğŸ•µï¸PerformAnalysis
uses:github/codeql-action/analyze@v3
with:
category:"/language:${{matrix.language}}"

dependency-scan:
name:ğŸ”DependencySecurityScan
runs-on:ubuntu-latest

steps:
-name:ğŸ“¥Checkout
uses:actions/checkout@v4

-name:ğŸ”RunSnyk
uses:snyk/actions/node@master
continue-on-error:true
env:
SNYK_TOKEN:${{secrets.SNYK_TOKEN}}
with:
args:--severity-threshold=high--all-projects

-name:ğŸ“ŠUploadSnykresults
uses:github/codeql-action/upload-sarif@v3
if:always()
with:
sarif_file:snyk.sarif

secret-scan:
name:ğŸ”‘SecretScanning
runs-on:ubuntu-latest

steps:
-name:ğŸ“¥Checkout
uses:actions/checkout@v4
with:
fetch-depth:0

-name:ğŸ”TruffleHogScan
uses:trufflesecurity/trufflehog@main
with:
path:./
base:${{github.event.repository.default_branch}}
head:HEAD

-name:ğŸ”GitGuardianScan
uses:GitGuardian/ggshield-action@master
env:
GITGUARDIAN_API_KEY:${{secrets.GITGUARDIAN_API_KEY}}
with:
args:scanci

container-scan:
name:ğŸ³ContainerSecurityScan
runs-on:ubuntu-latest
if:hashFiles('Dockerfile')!=''

steps:
-name:ğŸ“¥Checkout
uses:actions/checkout@v4

-name:ğŸ—ï¸BuildDockerimage
run:dockerbuild-tapp:latest.

-name:ğŸ”RunTrivy
uses:aquasecurity/trivy-action@master
with:
image-ref:'app:latest'
format:'sarif'
output:'trivy-results.sarif'

-name:ğŸ“ŠUploadTrivyresults
uses:github/codeql-action/upload-sarif@v3
if:always()
with:
sarif_file:'trivy-results.sarif'
